var petsnfans_data=null;var panel=null;var the_id_of_the_slider_view=null;var flag=false;function htmlEntities(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");}var $=jQuery;$.fn.map_input_interface=function(){var h=this.children(".textinput");var c=this.children(".sendinput");var e=this.parent().find("#discussions").attr("disid");var g=this.parent().find("#discussions");var a=null,f=null;c.bind("touchstart click",function(){if(!flag){flag=true;setTimeout(function(){flag=false;},100);remove_input();var i=$.trim(h.val());if(i==""){return false;}else{b(htmlEntities(i));}}return false;});function b(i){var j={discussion_id:e,comment_text:i};$.ajax({type:"POST",url:fans_obj.webview.ajaxCommunityPost,data:j,success:function(l){var k=parseInt($.trim(l));if(k>0){d($.extend({sub_comment_id:k},j));console.log("yes");return true;}else{return false;}},error:function(k){console.log("error");return false;}});}function d(i){a={comment_id:i.sub_comment_id,comment_text:i.comment_text,comment_user_id:0,firstname:fans_obj.webview.user_1,lastname:fans_obj.webview.user_2,profile_image:"",last_updated:"right now!"};var j=find_topic_id_at(e);console.log("find a key");console.log(j);petsnfans_data[j].subcomment_count++;if(typeof(petsnfans_data[j].subcomment_array)=="object"){petsnfans_data[j].subcomment_array.push(a);}else{petsnfans_data[j]["subcomment_array"]=[];petsnfans_data[j]["subcomment_array"][0]=a;}g.append(template_article_discussion(a));panel.updateSliderSize(true);setTimeout(function(){$("body").scrollTo("max",500,{axis:"y"});panel.updateSliderSize(true);},800);}};function build_slider_init(){if(the_id_of_the_slider_view==null){console.log("error, cannot initialize rslider - missing slider ID (the_id_of_the_slider_view)");return false;}$("#"+the_id_of_the_slider_view).royalSlider(fans_obj.jcomponent_royal_slider_petsnfan);panel=$("#"+the_id_of_the_slider_view).data("royalSlider");panel.ev.on("rsAfterSlideChange",function(a){callback_after_slider(panel.currSlideId);});}function find_topic_id(b){var a=null;$.each(petsnfans_data,function(c,d){if(d.comment_id==b){a=d;}});return a;}function find_topic_id_at(c){var b=false,a=0;$.each(petsnfans_data,function(d,e){if(e.comment_id==c){b=a;}a++;});return b;}function refresh(){LoadTopics(fans_obj.webview.ajaxtopics,template_article_topic,false);}function remove_input(){if($("#response_input_community").size()>0){$("#response_input_community").remove();}}function callback_after_slider(a){if(a==0){if(typeof(panel)=="object"){$("body").scrollTo("min",10,{axis:"y"});}setTimeout(function(){panel.updateSliderSize();},800);remove_input();refresh();}else{if(a==1&&$("#communityView").size()>0){if($("#response_input_community").size()==0){genInput();if(typeof(panel)=="object"){panel.updateSliderSize();setTimeout(function(){$("#communityView").scrollTo("max",500,{axis:"y"});},800);}}}}}function genInput(){var b=$("<input>",{"class":"textinput",id:"input_field",watermark:"input your response here",type:"text"});var c=$("<input>",{"class":"sendinput",id:"input_send",value:"send",type:"submit"});var a=$("<section>",{"class":"responseInput wrapper",id:"response_input_community"}).append(b,c);$(".page-wrap").append(a);$(".page-wrap .responseInput").map_input_interface();}function LoadDiscussion(g){if($("section#discussions")!=null){panel.removeSlide(1);}var c=find_topic_id(g);var a=c.subcomment_count;var b="";var d=null;var f=[];if(a>0){f=c.subcomment_array;}else{}if(f.length>0){if(f.length>20){d=f.splice(-20,20);b='<div class="topbanner">Show More...</div>';}else{d=f;}$.each(d,function(i,h){h.last_updated=fanslivingDateHesk(h.last_updated);b+=template_article_discussion(h);});}else{d=[];b='<div class="topbanner">Leave your comments here...</div>';}var e=$("<section>",{id:"discussions","class":"rsContent",disID:c.comment_id,update:c.last_updated,profile:c.profile_image}).append(b);panel.appendSlide(e);panel.next();}function LoadTopics(get_ajax_url,callback,is_initial){$.ajax({type:"POST",url:get_ajax_url,data:{},success:function(json){var jresponse=eval("("+json+")");petsnfans_data=jresponse;console.log(petsnfans_data);var length=jresponse.length;var section_topics_content="";if(jresponse.result=="no data"){}else{if(length>0){$.each(jresponse,function(key,value){value.last_updated=fanslivingDateHesk(value.last_updated);section_topics_content+=callback(value);});}if(section_topics_content!=""){$("section#mainpage").html("");$("section#mainpage").append(section_topics_content);if(is_initial){build_slider_init();}}}},error:function(json){console.log("error");}});}